#!/usr/bin/env bash
awk -v fil=$1 '
    BEGIN{
    i=0
    }
    /\[(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan (0[1-9]|[12][0-9]|3[0-1])|Feb (0[1-9]|1[0-9]|2[0-8])|Mar (0[1-9]|[12][0-9]|3[0-1])|Apr (0[1-9]|[12][0-9]|30)|May (0[1-9]|[12][0-9]|3[0-1])|Jun (0[1-9]|[12][0-9]|30)|Jul (0[1-9]|[12][0-9]|3[0-1])|Aug (0[1-9]|[12][0-9]|3[0-1])|Sep (0[1-9]|[12][0-9]|30)|Oct (0[1-9]|[12][0-9]|3[0-1])|Nov (0[1-9]|[12][0-9]|30)|Dec (0[1-9]|[12][0-9]|3[0-1])) ([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9] [0-9]{4}\] \[(error|notice)\] .+/{
    i+=1;
    }
    END{
    if(i==NR){
        system("bash make_csv.sh " fil);
    }
    else{
        system("echo err");
        system("rm "fil);
    }
    }
' $1